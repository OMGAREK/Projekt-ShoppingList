<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodel="clr-namespace:ShoppingListAW4E.ViewModels"
             x:Class="ShoppingListAW4E.Views.ShoppingListPage"
             x:Name="ShoppingPage"
             Title="Lista zakupÃ³w">

    <ContentPage.BindingContext>
        <viewmodel:ShoppingListViewModel/>
    </ContentPage.BindingContext>

    <ScrollView>
    <VerticalStackLayout Padding="20" Spacing="10">

        <Label Text="Dodaj produkt"
               FontSize="22"
               FontAttributes="Bold"/>

        <Entry Placeholder="Nazwa produktu"
               Text="{Binding NewProductName}"/>

        <Entry Placeholder="Ilosc"
               Keyboard="Numeric"
               Text="{Binding NewProductQuantity}" />


        <Entry Placeholder="Jednostka (kg, szt., l)"
               Text="{Binding NewProductUnit}"/>

        <Picker Title="Kategoria"
                ItemsSource="{Binding Categories}"
                ItemDisplayBinding="{Binding Name}"
                SelectedItem="{Binding SelectedCategory}"/>

        <Button Text="Dodaj produkt"
                Command="{Binding AddProductCommand}"/>

            <CollectionView ItemsSource="{Binding Products}">
                <CollectionView.ItemTemplate>
                    <DataTemplate>

                        <Frame Padding="10" Margin="5">
                            <Grid ColumnDefinitions="2*,Auto,Auto,Auto,Auto"
                              RowDefinitions="Auto,Auto">

                                <Label Text="{Binding Name}"
                                   Grid.Row="0"
                                   Grid.Column="0"
                                   FontSize="18">
                                    <Label.Triggers>
                                        <DataTrigger TargetType="Label"
                                                 Binding="{Binding IsBought}"
                                                 Value="True">
                                            <Setter Property="TextDecorations" Value="Strikethrough"/>
                                            <Setter Property="TextColor" Value="Gray"/>
                                        </DataTrigger>
                                    </Label.Triggers>
                                </Label>
                                <Label Grid.Row="1"
                                   Grid.Column="0"
                                   FontSize="12"
                                   TextColor="Gray"
                                   Text="{Binding CategoryName}"/>
                                
                                <Label Grid.Row="1"
                                   Grid.Column="1"
                                   FontSize="12"
                                   TextColor="Gray"
                                   Text="{Binding Unit}"/>
                                
                                <Button Text="-"
                                    Grid.Column="1"
                                    Grid.Row="0"
                                    Command="{Binding DecreaseCommand}"/>

                                <Entry Text="{Binding Quantity}"
                                   Keyboard="Numeric"
                                   WidthRequest="60"
                                   Grid.Column="2"
                                   Grid.Row="0"
                                   VerticalTextAlignment="Center"/>

                                <Button Text="+"
                                    Grid.Column="3"
                                    Grid.Row="0"
                                    Command="{Binding IncreaseCommand}"/>

                                <Button Text="Kupione"
                                    Grid.Column="4"
                                    Grid.Row="0"
                                    Command="{Binding BindingContext.ToggleBoughtCommand,
                                              Source={x:Reference ShoppingPage}}"
                                    CommandParameter="{Binding}"/>

                                <Button Text="Usun"
                                    Grid.Column="4"
                                    Grid.Row="1"
                                    TextColor="Red"
                                    Command="{Binding BindingContext.RemoveProductCommand,
                                              Source={RelativeSource AncestorType={x:Type ContentPage}}}"
                                    CommandParameter="{Binding}"/>

                            </Grid>
                        </Frame>

                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
