using ShoppingListAW4E.Models;
using ShoppingListAW4E.ViewModels;

namespace ShoppingListAW4E.Views
{
    // Ten plik definiuje zachowanie strony "ShoppingListPage" (widok listy zakupów).
    // Wyjaśnienie krok po kroku dla osoby bez doświadczenia w programowaniu:
    // - Plik XAML (ShoppingListPage.xaml) opisuje układ interfejsu (pola tekstowe, przyciski,
    // listy). Ten plik .cs (kod za) zawiera funkcje, które są wywoływane gdy użytkownik
    // kliknie przyciski (np. doda kategorię, kliknie kategorię, doda produkt).
    // - W aplikacji stosujemy wzorzec MVVM: "ViewModel" (klasa ShoppingListViewModel)
    // przechowuje dane i logikę, a strona (View) wywołuje metody ViewModelu, by zmienić dane.
    public partial class ShoppingListPage : ContentPage
    {
        public ShoppingListPage()
        {
            InitializeComponent();
        }

        // Ten handler jest wywoływany, gdy użytkownik kliknie nazwę kategorii.
        // Co się dzieje w prostych słowach:
        //1. Znajdujemy obiekt Category powiązany z klikniętym przyciskiem.
        //2. Pobieramy ViewModel (logikę aplikacji) z BindingContext strony.
        //3. Prosmy ViewModel o przełączenie stanu (zwinięta/rozwinięta).
        void OnCategoryClicked(object sender, EventArgs e)
        {
            Button button = sender as Button;
            Category category = button?.BindingContext as Category;

            ShoppingListViewModel viewModel = BindingContext as ShoppingListViewModel;
            viewModel?.ToggleCategory(category);
        }

        // Ten handler obsługuje kliknięcie przycisku "Dodaj kategorię".
        // Jeśli w polu wpisano nazwę, wywołujemy metodę ViewModelu, która doda kategorię
        // do listy i zapisze zmiany na dysku.
        void OnAddCategoryClicked(object sender, EventArgs e)
        {
            ShoppingListViewModel viewModel = BindingContext as ShoppingListViewModel;
            viewModel?.AddCategory();
        }

        // Ten handler obsługuje kliknięcie przycisku "Dodaj produkt" w formularzu.
        // Przekazuje do ViewModelu dane z pól formularza. ViewModel dba o sprawdzenie
        // poprawności i zapis.
        void OnAddProductClicked(object sender, EventArgs e)
        {
            ShoppingListViewModel viewModel = BindingContext as ShoppingListViewModel;
            viewModel?.AddProduct();
        }

        // Ten handler jest wywoływany, gdy użytkownik kliknie przycisk usunięcia kategorii.
        // Kroki:
        //1. Pobieramy obiekt Category z kontekstu przycisku.
        //2. Wywołujemy metodę ViewModelu, która usunie kategorię i wszystkie produkty
        // do niej przypisane, a następnie zapisze zmiany.
        void OnRemoveCategoryClicked(object sender, EventArgs e)
        {
            Button button = sender as Button;
            Category category = button?.BindingContext as Category;

            ShoppingListViewModel viewModel = BindingContext as ShoppingListViewModel;
            viewModel?.RemoveCategory(category);
        }
    }
}